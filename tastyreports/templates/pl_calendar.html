{% extends "layout.html" %}
{% block title %}P/L Calendar{% endblock %}
{% block head %}
  {{ super() }}
  <style type="text/css">
    
  </style>
  
  <script src='https://cdn.jsdelivr.net/npm/fullcalendar@6.1.8/index.global.min.js'></script>
{% endblock %}
{% block content %}
  <h2>P/L Calendar</h2>
  <form action="{{ url_for('pl_calendar') }}" method="post" class="inline-form">
    <label for="start_date">Start Date:</label><br>
    <input type="text" id="start_date" name="start_date" value="{{ start_date }}"><br>
    <label for="end_date">End Date:</label><br>
    <input type="text" id="end_date" name="end_date" value="{{ end_date }}"><br>
    <input type="submit" value="Submit">
  </form>
  <div id='calendar'></div>

  {% for day in data %}
    <p>{{ day }}</p>
  {% endfor %}

  {% for item in snapshots %}
    <p>{{ item }}</p>
  {% endfor %}

  <script>
  $( function() {
    $( "#start_date" ).datepicker({ dateFormat: 'yy-mm-dd' });
    $( "#end_date" ).datepicker({ dateFormat: 'yy-mm-dd' });
  } );
  document.addEventListener('DOMContentLoaded', function() {
    var calendarEl = document.getElementById('calendar');
    var calendar_data = JSON.parse('{{ data | safe }}');
    console.log(calendar_data)
    var events = calendar_data.map(function(item) {
      return {
        title: item.date + '\n' + 'BP Use: ' + item.buying_power_used,
        start: item.date
      };
    });
    var calendar = new FullCalendar.Calendar(calendarEl, {
      initialView: 'dayGridMonth',
      events: events,
      eventContent: function(arg) {
        console.log(arg.event)
        var html = '<div class="my-custom-class">';
        html += '<p>' + arg.event.title.split('\n')[0] + '</p>'; // Display date
        html += '<p>' + arg.event.title.split('\n')[1] + '</p>'; // Display buying power usage
        html += '</div>';

        return { html: html };
      }
    });
    calendar.render();
  });
  </script>
{% endblock %}
